<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ü—Ä–æ—Ñ–∏–ª—å - –ü–æ–ª–∏–ê—Ä—Ç</title>
    <link rel="stylesheet" href="css/HeaderAndFooter.css">
    <link rel="stylesheet" href="css/personal.css">
    <link rel="stylesheet" href="css/auth.css">
</head>
<body>
    <!-- –•–µ–¥–µ—Ä -->
    <header class="header"></header>

    <main class="profile-page">
        <div class="container">
            <!-- –ë–∞–Ω–Ω–µ—Ä –ø—Ä–æ—Ñ–∏–ª—è -->
            <div class="profile-banner">
                <div class="profile-banner__content">
                    <h1>–õ–∏—á–Ω—ã–π –∫–∞–±–∏–Ω–µ—Ç</h1>
                    <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–∞—à–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏, –∑–∞–∫–∞–∑–∞–º–∏ –∏ –∫–æ—Ä–∑–∏–Ω–æ–π</p>
                </div>
            </div>

            <div class="profile-layout">
                <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –ø—Ä–æ—Ñ–∏–ª—è -->
                <aside class="profile-sidebar">
                    <!-- –ê–≤–∞—Ç–∞—Ä –∏ –æ—Å–Ω–æ–≤–Ω–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è -->
                    <div class="profile-card">
                        <div class="profile-avatar" id="userAvatar">
                            <!-- –ê–≤–∞—Ç–∞—Ä –∑–∞–≥—Ä—É–∑–∏—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                            <div class="avatar-placeholder">
                                <span id="avatarInitials">–ò</span>
                            </div>
                            <div class="avatar-overlay" onclick="testAvatarUpload()">
                                <span class="avatar-change-icon">üì∑</span>
                                <span class="avatar-change-text">–ò–∑–º–µ–Ω–∏—Ç—å</span>
                            </div>
                            <input type="file" id="avatarInput" accept="image/*" style="display: none;">
                        </div>
                        
                        <div class="profile-info">
                            <h2 class="profile-name" id="userName">–ò–≤–∞–Ω –ò–≤–∞–Ω–æ–≤</h2>
                            <p class="profile-email" id="userEmail">user@example.com</p>
                            <p class="profile-role" id="userRole">–ü–æ–∫—É–ø–∞—Ç–µ–ª—å</p>
                        </div>

                        <div class="profile-stats">
                            <div class="stat-item">
                                <div class="stat-icon">üõí</div>
                                <div class="stat-info">
                                    <div class="stat-value" id="cartCount">0</div>
                                    <div class="stat-label">–≤ –∫–æ—Ä–∑–∏–Ω–µ</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon">üì¶</div>
                                <div class="stat-info">
                                    <div class="stat-value" id="ordersCount">0</div>
                                    <div class="stat-label">–∑–∞–∫–∞–∑–æ–≤</div>
                                </div>
                            </div>
                            <div class="stat-item">
                                <div class="stat-icon">‚≠ê</div>
                                <div class="stat-info">
                                    <div class="stat-value" id="reviewsCount">0</div>
                                    <div class="stat-label">–æ—Ç–∑—ã–≤–æ–≤</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- –ù–∞–≤–∏–≥–∞—Ü–∏—è -->
                    <nav class="profile-nav">
                        <button class="nav-btn active" data-tab="personal">
                            <span class="nav-icon">üë§</span>
                            <span class="nav-text">–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</span>
                        </button>
                        <button class="nav-btn" data-tab="security">
                            <span class="nav-icon">üîí</span>
                            <span class="nav-text">–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</span>
                        </button>
                        <button class="nav-btn" data-tab="cart">
                            <span class="nav-icon">üõí</span>
                            <span class="nav-text">–ö–æ—Ä–∑–∏–Ω–∞</span>
                            <span class="nav-badge" id="cartBadge">0</span>
                        </button>
                        <button class="nav-btn" data-tab="orders">
                            <span class="nav-icon">üì¶</span>
                            <span class="nav-text">–ú–æ–∏ –∑–∞–∫–∞–∑—ã</span>
                        </button>
                        <button class="nav-btn" data-tab="reviews">
                            <span class="nav-icon">‚≠ê</span>
                            <span class="nav-text">–ú–æ–∏ –æ—Ç–∑—ã–≤—ã</span>
                        </button>
                        
                        <div class="nav-divider"></div>
                        
                        <button class="nav-btn nav-btn--logout" id="logoutBtn">
                            <span class="nav-icon">üö™</span>
                            <span class="nav-text">–í—ã–π—Ç–∏</span>
                        </button>
                    </nav>
                </aside>

                <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ - –∫–æ–Ω—Ç–µ–Ω—Ç -->
                <div class="profile-content">
                    <!-- –õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ -->
                    <div class="tab-content active" id="personalTab">
                        <div class="tab-header">
                            <h2>–õ–∏—á–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ</h2>
                            <p>–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –æ—Å–Ω–æ–≤–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –ø—Ä–æ—Ñ–∏–ª—è</p>
                        </div>
                        
                        <form class="profile-form" id="personalForm">
                            <div class="form-row">
                                <div class="form-group">
                                    <label for="firstName">–ò–º—è</label>
                                    <input type="text" id="firstName" name="firstName" 
                                           placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à–µ –∏–º—è" required>
                                </div>
                                <div class="form-group">
                                    <label for="lastName">–§–∞–º–∏–ª–∏—è</label>
                                    <input type="text" id="lastName" name="lastName" 
                                           placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à—É —Ñ–∞–º–∏–ª–∏—é" required>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" id="email" name="email" 
                                       placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à email" required>
                            </div>
                            
                            <div class="form-group">
                                <label for="phone">–¢–µ–ª–µ—Ñ–æ–Ω</label>
                                <input type="tel" id="phone" name="phone" 
                                    placeholder="+7 (___) ___-__-__"
                                    pattern="\+7\s\(\d{3}\)\s\d{3}-\d{2}-\d{2}"
                                    title="–§–æ—Ä–º–∞—Ç: +7 (XXX) XXX-XX-XX">
                            </div>
                            
                            <div class="form-group">
                                <label for="address">–ê–¥—Ä–µ—Å –¥–æ—Å—Ç–∞–≤–∫–∏</label>
                                <textarea id="address" name="address" 
                                          rows="3" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à –∞–¥—Ä–µ—Å"></textarea>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn--secondary" id="cancelPersonal">
                                    –û—Ç–º–µ–Ω–∞
                                </button>
                                <button type="submit" style="border: none !important;" class="btn btn--primary" id="savePersonal">
                                    –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∏–∑–º–µ–Ω–µ–Ω–∏—è
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å -->
                    <div class="tab-content" id="securityTab">
                        <div class="tab-header">
                            <h2>–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å</h2>
                            <p>–ò–∑–º–µ–Ω–µ–Ω–∏–µ –ø–∞—Ä–æ–ª—è –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏</p>
                        </div>
                        
                        <form class="profile-form" id="securityForm">
                            <div class="form-group">
                                <label for="currentPassword">–¢–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å</label>
                                <div class="password-input">
                                    <input type="password" id="currentPassword" 
                                           placeholder="–í–≤–µ–¥–∏—Ç–µ —Ç–µ–∫—É—â–∏–π –ø–∞—Ä–æ–ª—å" required>
                                    <button type="button" class="password-toggle" 
                                            data-target="currentPassword">üëÅÔ∏è</button>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="newPassword">–ù–æ–≤—ã–π –ø–∞—Ä–æ–ª—å</label>
                                <div class="password-input">
                                    <input type="password" id="newPassword" 
                                           placeholder="–í–≤–µ–¥–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" required>
                                    <button type="button" class="password-toggle" 
                                            data-target="newPassword">üëÅÔ∏è</button>
                                </div>
                                <div class="password-strength">
                                    <div class="strength-bar"></div>
                                    <div class="strength-text">–ù–∞–¥–µ–∂–Ω–æ—Å—Ç—å –ø–∞—Ä–æ–ª—è: <span>—Å–ª–∞–±—ã–π</span></div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label for="confirmPassword">–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å</label>
                                <div class="password-input">
                                    <input type="password" id="confirmPassword" 
                                           placeholder="–ü–æ–≤—Ç–æ—Ä–∏—Ç–µ –Ω–æ–≤—ã–π –ø–∞—Ä–æ–ª—å" required>
                                    <button type="button" class="password-toggle" 
                                            data-target="confirmPassword">üëÅÔ∏è</button>
                                </div>
                                <div class="password-match" id="passwordMatch"></div>
                            </div>
                            
                            <div class="form-actions">
                                <button type="button" class="btn btn--secondary" id="cancelSecurity">
                                    –û—Ç–º–µ–Ω–∞
                                </button>
                                <button type="submit" style="border: none !important;" class="btn btn--primary" id="changePassword">
                                    –ò–∑–º–µ–Ω–∏—Ç—å –ø–∞—Ä–æ–ª—å
                                </button>
                            </div>
                        </form>
                    </div>

                    <!-- –ö–æ—Ä–∑–∏–Ω–∞ -->
                    <div class="tab-content" id="cartTab">
                        <div class="tab-header">
                            <h2>–ö–æ—Ä–∑–∏–Ω–∞</h2>
                            <p>–¢–æ–≤–∞—Ä—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –¥–æ–±–∞–≤–∏–ª–∏ –≤ –∫–æ—Ä–∑–∏–Ω—É</p>
                        </div>
                        
                        <div class="cart-container">
                            <!-- –°–ø–∏—Å–æ–∫ —Ç–æ–≤–∞—Ä–æ–≤ –≤ –∫–æ—Ä–∑–∏–Ω–µ -->
                            <div class="cart-items" id="cartItems">
                                <!-- –¢–æ–≤–∞—Ä—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                                <div class="cart-empty">
                                    <div class="empty-icon">üõí</div>
                                    <h3>–ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞</h3>
                                    <p>–î–æ–±–∞–≤—å—Ç–µ —Ç–æ–≤–∞—Ä—ã –∏–∑ –∫–∞—Ç–∞–ª–æ–≥–∞</p>
                                    <a href="catalog.html" style="border: none !important;" class="btn btn--primary">–ü–µ—Ä–µ–π—Ç–∏ –≤ –∫–∞—Ç–∞–ª–æ–≥</a>
                                </div>
                            </div>
                            
                            <!-- –ò—Ç–æ–≥–æ -->
                            <div class="cart-summary" id="cartSummary" style="display: none;">
                                <h3>–ò—Ç–æ–≥–æ</h3>
                                <div class="summary-row">
                                    <span>–¢–æ–≤–∞—Ä–æ–≤:</span>
                                    <span id="totalItems">0</span>
                                </div>
                                <div class="summary-row">
                                    <span>–û–±—â–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å:</span>
                                    <span class="total-price" id="totalPrice">0 ‚ÇΩ</span>
                                </div>
                                <div class="summary-row">
                                    <span>–î–æ—Å—Ç–∞–≤–∫–∞:</span>
                                    <span id="deliveryCost">–ë–µ—Å–ø–ª–∞—Ç–Ω–æ</span>
                                </div>
                                <div class="summary-row summary-total">
                                    <span>–ö –æ–ø–ª–∞—Ç–µ:</span>
                                    <span class="final-price" id="finalPrice">0 ‚ÇΩ</span>
                                </div>
                                <button class="btn btn--primary btn--large" id="checkoutBtn">
                                    –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
                                </button>
                                <p class="cart-note">
                                    * –î–æ—Å—Ç–∞–≤–∫–∞ –±–µ—Å–ø–ª–∞—Ç–Ω–∞ –ø—Ä–∏ –∑–∞–∫–∞–∑–µ –æ—Ç 15 000 ‚ÇΩ
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- –ú–æ–∏ –∑–∞–∫–∞–∑—ã -->
                    <div class="tab-content" id="ordersTab">
                        <div class="tab-header">
                            <h2>–ú–æ–∏ –∑–∞–∫–∞–∑—ã</h2>
                            <p>–ò—Å—Ç–æ—Ä–∏—è –≤–∞—à–∏—Ö –∑–∞–∫–∞–∑–æ–≤</p>
                        </div>
                        
                        <div class="orders-container" id="ordersContainer">
                            <!-- –ó–∞–∫–∞–∑—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                            <div class="orders-empty">
                                <div class="empty-icon">üì¶</div>
                                <h3>–ó–∞–∫–∞–∑–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                                <p>–°–æ–≤–µ—Ä—à–∏—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –∑–∞–∫–∞–∑!</p>
                            </div>
                        </div>
                    </div>

                    <!-- –ú–æ–∏ –æ—Ç–∑—ã–≤—ã -->
                    <div class="tab-content" id="reviewsTab">
                        <div class="tab-header">
                            <h2>–ú–æ–∏ –æ—Ç–∑—ã–≤—ã</h2>
                            <p>–û—Ç–∑—ã–≤—ã, –∫–æ—Ç–æ—Ä—ã–µ –≤—ã –æ—Å—Ç–∞–≤–∏–ª–∏</p>
                        </div>
                        
                        <div class="reviews-container" id="userReviews">
                            <!-- –û—Ç–∑—ã–≤—ã –∑–∞–≥—Ä—É–∂–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ JS -->
                            <div class="reviews-empty">
                                <div class="empty-icon">‚≠ê</div>
                                <h3>–û—Ç–∑—ã–≤–æ–≤ –ø–æ–∫–∞ –Ω–µ—Ç</h3>
                                <p>–û—Å—Ç–∞–≤—å—Ç–µ —Å–≤–æ–π –ø–µ—Ä–≤—ã–π –æ—Ç–∑—ã–≤ –Ω–∞ —Ç–æ–≤–∞—Ä!</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- –§—É—Ç–µ—Ä -->
    <footer class="footer"></footer>

    <!-- –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ JS —Ñ–∞–π–ª–æ–≤ -->
    <script src="https://unpkg.com/pocketbase/dist/pocketbase.umd.js"></script>
    <script src="js/header.js"></script>
    <script src="js/auth-state.js"></script>
    <script src="js/personal.js"></script>
    <script src="js/footer.js"></script>
    
    <script>
        // –†–µ–¥–∏—Ä–µ–∫—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É –≤—Ö–æ–¥–∞ –µ—Å–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –Ω–µ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(() => {
                if (!window.authManager || !window.authManager.isAuthenticated()) {
                    window.location.href = 'login.html?redirect=profile.html';
                }
            }, 1000);
        });

        // –¢–µ—Å—Ç–æ–≤—ã–µ —Ñ—É–Ω–∫—Ü–∏–∏
function testAvatarUpload() {
    const fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = 'image/*';
    
    fileInput.onchange = async (e) => {
        const file = e.target.files[0];
        if (!file) return;
        
        console.log('üß™ –¢–µ—Å—Ç–∏—Ä—É–µ–º –∑–∞–≥—Ä—É–∑–∫—É —Ñ–∞–π–ª–∞:', {
            name: file.name,
            size: file.size,
            type: file.type
        });
        
        // –°–æ–∑–¥–∞–µ–º FormData
        const formData = new FormData();
        formData.append('avatar', file);
        
        try {
            console.log('üì§ –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Ç–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å...');
            const response = await fetch(`http://127.0.0.1:8090/api/collections/users/records/${window.userProfile.currentUser.id}`, {
                method: 'PATCH',
                headers: {
                    'Authorization': window.userProfile.pb.authStore.token
                },
                body: formData
            });
            
            const result = await response.json();
            console.log('üì• –û—Ç–≤–µ—Ç —Å–µ—Ä–≤–µ—Ä–∞:', result);
            
            if (response.ok) {
                // –û–±–Ω–æ–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ
                window.userProfile.loadUserData();
            }
        } catch (error) {
            console.error('‚ùå –û—à–∏–±–∫–∞ —Ç–µ—Å—Ç–∞:', error);
        }
    };
    
    fileInput.click();
}
    </script>
</body>
</html>